apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    monitoring-key: middleware
    prometheus: application-monitoring
    role: alert-rules
  name: mdc-operator-monitoring
spec:
  groups:
    - name: general.rules
      rules:
      - alert: MobileDeveloperConsoleOperatorDown
        expr: absent(up{job="mobile-developer-console-operator"} == 1)
        for: 5m
        labels:
          severity: critical
        annotations:
          description: "The MDC Operator has been down for more than 5 minutes."
          summary: "The MDC Operator is down. For more information on the MDC Operator, see https://github.com/aerogear/mobile-developer-console-operator"
          sop_url: "https://github.com/aerogear/mobile-developer-console/blob/{{ mdc_operator_release_tag }}/SOP/SOP-operator.adoc"
      - alert: MobileDeveloperConsolePodCount
        annotations:
          description: "The Pod count for the MDC Server has changed in the last 5 minutes and is lower than the required minimum."
          summary: "Pod count for namespace {{ mdc_namespace }} is {{ '{{' }} $value {{ '}}' }}. Expected at least 2 pods. For more information on the MDC Operator, see https://github.com/aerogear/mobile-developer-console-operator"
          sop_url: "https://github.com/aerogear/mobile-developer-console/blob/{{ mdc_operator_release_tag }}/SOP/SOP-operator.adoc"
        expr: |
          (1-absent(kube_pod_status_ready{condition="true", namespace="{{ mdc_namespace }}"})) or sum(kube_pod_status_ready{condition="true", namespace="{{ mdc_namespace }}"}) < 2
        for: 5m
        labels:
          severity: warning
